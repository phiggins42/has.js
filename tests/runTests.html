<!DOCTYPE html>
<html>
    <head>
        <style type="text/css">
            .yes {
                color:green;
            }
            .no {
                color:red;
            }
            #ua {
                font-weight:bold;
            }
            #output { list-style:none; }
            #output li {
                float:left;
                width:250px;
                padding:5px;
                border-bottom:1px dotted #ededed;
            }
        </style>
        <title>has.js tests</title>
        <script src="../has.js"></script>
        <script>
        
            // some return objects contain additional information 
            // about how to handle a situation. define whatever
            // keys are handled specially in this way here:
            has.specials = {
                "native-xhr": "ACTIVEX"
            }
        
            has.byId = function(id){
                return document.getElementById(id);
            }
            
        
            // redundant test
            has.add("js-enabled-direct", true);
            
            var lazy = 0;
            has.add("js-enabled-lazy", function(){ lazy++; return true; });
            if(!lazy && !has("js-enabled-lazy")){
                alert("lazy test failed.");
            }
            
            var run = 0;
            has.add("js-enabled-lazy-now", function(){ run++; return true; }, true);
            if(!run){
                alert("lazy with immediate execution failed");
            }
        </script>
        
        <script>
            // FIXME: should we doc.write in Prototype.js || Moo Core here to see if we detect safely/correctly
            // in presence of known *.prototype extending libs?
            // document.write('<script src="......"><' + '/script>');
        
            // timing mech
            window.beforeLoading = +new Date;
        </script>
        <script src="../detect/bugs.js"></script>

        <script src="../detect/array.js"></script>
        <script src="../detect/canvas.js"></script>
        <script src="../detect/css.js"></script>
        <script src="../detect/dates.js"></script>
        <script src="../detect/dom.js"></script>
        <script src="../detect/features.js"></script>
        <script src="../detect/function.js"></script>
        <script src="../detect/json.js"></script>
        <script src="../detect/object.js"></script>
        <script src="../detect/strings.js"></script>
        <script src="../detect/events.js"></script>
        
        
        
        
        
        
        <script>window.afterLoading = (+new Date - window.beforeLoading)</script>
    </head>
    <body>
        <h1>has.js</h1>
        <p>Feature Detection, al la carte stylie</p>
        
        <fieldset>
            <legend>Results (js-enabled-* tests are fake) <span id="took"></span></legend>
            <ul id="output"></ul>
        </fieldset>
        
        <p>Test loading and registration took <span id="took2"></span></p>
        <p>Your userAgent is being reported as: <span id="ua"></span></p>

        <form action='report.php' method="POST">
            <button id="boom" disabled="disabled">Report these to teh matrix</button>
            <div id="resultinputs"></div>
            <input type="hidden" name="useragent" id="useragent">
            <input type="hidden" name="cost" id="cost">
        </form>
        
        <script>
        
            var out = document.getElementById("output"), 
                html = [], data = [],
                nao = +new Date,
                results = has.all(),
        done = +new Date,
        bugRE = /^bug-/
            ;

      function resultClass(result, isBug, special){
        // format bug-* tests opposite from others
        if(isBug && result != 'error'){
          return (result == true ? "no" : "yes");
        }
        return (result == true ? "yes" : "no");
      }

            for(var i in results){
                
                var special = "", r = results[i];
                if(i in has.specials){
                    special = r[has.specials[i]] || "";
                }
                
                if(r == "error"){
                    special = r.ERROR_MSG;
                }
                
                data.push("<input type='hidden' name='", i, "' value='", results[i] + special ,"'>");
                html.push("<li>", i ," <em class='", resultClass(r, bugRE.test(i)), "'>", (r === null ? 'n/a' : !!r) , "</em>", special, "</li>");
            }
            
            out.innerHTML = html.join("");
            
            has.byId("resultinputs").innerHTML = data.join("");
            
            has.byId("took").innerHTML = "took: " + (done - nao) + "ms";
            has.byId("cost").value = has.byId("took2").innerHTML = window.afterLoading + "ms";
            has.byId("useragent").value = has.byId("ua").innerHTML = navigator.userAgent;
            
            has.byId("boom").disabled = false; // backend not in place
        </script>
    </body>
</html>
